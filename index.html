<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Car Audit System</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6fb;
  padding:15px;
}
.card{
  background:#fff;
  padding:15px;
  border-radius:8px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
  max-width:420px;
  margin:auto;
}
input,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  font-size:15px;
}
button{
  background:#667eea;
  color:#fff;
  border:none;
  border-radius:5px;
}
button:disabled{
  background:#aaa;
}
.hidden{display:none;}
</style>
</head>

<body>

<div class="card">
  <h3>Car Audit (Reg No)</h3>

  <!-- SEARCH -->
  <input id="regNo" placeholder="Enter Registration No">
  <button onclick="searchCar()">Search</button>

  <!-- FORM -->
  <div id="formBox" class="hidden">
    <input id="brand" placeholder="Brand">
    <input id="model" placeholder="Model">
    <input id="year" placeholder="Year">
    <input id="color" placeholder="Color">
    <input id="purchasePrice" placeholder="Purchase Price">

    <button onclick="saveCar()">Save</button>
  </div>

  <p id="msg"></p>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFherN-MJn4lxc5dFCKikjYx1vqm-NymFj0Eb833Wqk0fQKBpUs1s0JVXobZvQ3b74/exec";
let MODE = "ADD";

function searchCar(){
  let reg = regNo.value.trim();
  if(!reg){ alert("Enter Reg No"); return; }

  fetch(SCRIPT_URL + "?regNo=" + reg)
  .then(res => res.json())
  .then(data => {
    document.getElementById("formBox").classList.remove("hidden");

    if(data.found){
      MODE = "EDIT";
      brand.value = data.car.brand;
      model.value = data.car.model;
      year.value = data.car.year;
      color.value = data.car.color;
      purchasePrice.value = data.car.price;
      msg.innerHTML = "✔ Car Found (Edit Mode)";
    }else{
      MODE = "ADD";
      brand.value = model.value = year.value = color.value = purchasePrice.value = "";
      msg.innerHTML = "➕ New Car (Add Mode)";
    }
  });
}

function saveCar(){
  let payload = {
    mode: MODE,
    regNo: regNo.value,
    brand: brand.value,
    model: model.value,
    year: year.value,
    color: color.value,
    price: purchasePrice.value
  };

  fetch(SCRIPT_URL,{
    method:"POST",
    body: JSON.stringify(payload)
  })
  .then(r=>r.text())
  .then(res=>{
    msg.innerHTML = "✅ Data Saved Successfully";
  });
}
</script>

</body>
</html>